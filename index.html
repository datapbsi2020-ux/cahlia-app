<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ujian Online - SMP Negeri 1 Arahan</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel untuk JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Running Text Animation */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* Print Styles untuk Laporan PDF */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; color: black; }
            .print-container { padding: 20px; width: 100%; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid black; padding: 8px; }
        }
        .print-only { display: none; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATA SEED (DEFAULT) ---
        const DEFAULT_TEACHERS = [
            { id: 1, name: 'Bpk. Budi Santoso', username: 'guru1', password: '123' },
            { id: 2, name: 'Ibu Siti Aminah', username: 'guru2', password: '123' }
        ];

        const DEFAULT_STUDENTS = [
            { id: 1, name: 'Siswa Contoh', nim: '12345', username: 'siswa', password: '123' }
        ];

        const DEFAULT_SUBJECTS = [
            { id: 1, name: 'Matematika', teacher: 'Bpk. Budi Santoso' },
            { id: 2, name: 'Bahasa Indonesia', teacher: 'Ibu Siti Aminah' }
        ];

        const DEFAULT_EXAMS = []; 

        // --- LOGIN COMPONENT ---
        const LoginView = ({ handleLogin, loginInput, setLoginInput }) => (
            <div className="min-h-screen flex flex-col bg-gray-100">
                <div className="bg-blue-900 text-white py-3 shadow-md marquee-container no-print">
                    <span className="marquee-text font-bold text-lg">
                        SELAMAT DATANG DI APLIKASI UJIAN ONLINE SMP NEGERI 1 ARAHAN â€” JUJUR ADALAH KUNCI KESUKSESAN
                    </span>
                </div>

                <div className="flex-grow flex items-center justify-center p-4 no-print">
                    <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border-t-4 border-blue-600 fade-in">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i className="fas fa-school text-4xl text-blue-600"></i>
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800">Login Aplikasi</h2>
                            <p className="text-gray-500 text-sm">SMP Negeri 1 Arahan</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-5">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Username</label>
                                <div className="relative">
                                    <input 
                                        type="text" 
                                        required
                                        className="w-full border p-3 pl-10 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                                        value={loginInput.username}
                                        onChange={(e) => setLoginInput({...loginInput, username: e.target.value})}
                                        placeholder="Masukkan username..."
                                    />
                                    <i className="fas fa-user absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <div className="relative">
                                    <input 
                                        type="password" 
                                        required
                                        className="w-full border p-3 pl-10 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition"
                                        value={loginInput.password}
                                        onChange={(e) => setLoginInput({...loginInput, password: e.target.value})}
                                        placeholder="Masukkan password..."
                                    />
                                    <i className="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            <button className="w-full bg-blue-700 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition shadow-lg">
                                MASUK
                            </button>
                        </form>
                    </div>
                </div>
                <footer className="text-center py-4 text-gray-500 text-sm no-print">
                    &copy; 2024 SMP Negeri 1 Arahan
                </footer>
            </div>
        );

        // --- COMPONENT: TEACHER DASHBOARD ---
        const TeacherDashboard = ({ user, exams, setExams, results, handleLogout }) => {
            const [activeTab, setActiveTab] = useState('pts'); // pts, pas, results
            const [editingExamId, setEditingExamId] = useState(null);
            
            // Filter exams owned by this teacher
            const myExams = exams.filter(e => e.teacher === user.name && e.category === activeTab);
            const myResults = results.filter(r => r.teacher === user.name); // Asumsi result menyimpan nama guru

            // State for creating exam
            const [newExam, setNewExam] = useState({ subject: '', date: '', start: '', end: '' });
            const [newQuestion, setNewQuestion] = useState({ type: 'multiple_choice', question: '', options: ['', '', '', ''], correctAnswer: '', points: 10 });

            // Create Exam Logic
            const createExam = () => {
                if(!newExam.subject || !newExam.date) return alert("Lengkapi data jadwal.");
                const examPacket = {
                    id: Date.now(),
                    category: activeTab,
                    subject: newExam.subject,
                    teacher: user.name,
                    date: newExam.date,
                    start: newExam.start,
                    end: newExam.end,
                    questions: []
                };
                setExams([...exams, examPacket]);
                setNewExam({ subject: '', date: '', start: '', end: '' });
                alert("Jadwal berhasil dibuat.");
            };

            const deleteExam = (id) => {
                if(confirm("Hapus ujian ini?")) setExams(exams.filter(e => e.id !== id));
            };

            // Add Question Logic
            const addQuestionToExam = () => {
                if(!editingExamId || !newQuestion.question) return;
                const updatedExams = exams.map(exam => {
                    if(exam.id === editingExamId) {
                        return { ...exam, questions: [...exam.questions, { ...newQuestion, id: Date.now() }] };
                    }
                    return exam;
                });
                setExams(updatedExams);
                setNewQuestion({ type: 'multiple_choice', question: '', options: ['', '', '', ''], correctAnswer: '', points: 10 });
            };
             
            const deleteQuestion = (examId, qId) => {
                const updatedExams = exams.map(exam => {
                    if(exam.id === examId) return { ...exam, questions: exam.questions.filter(q => q.id !== qId) };
                    return exam;
                });
                setExams(updatedExams);
            };

            const activeExam = exams.find(e => e.id === editingExamId);

            return (
                <div className="min-h-screen flex bg-gray-50">
                     <div className="w-64 bg-teal-800 text-white flex flex-col shadow-xl fixed h-full overflow-y-auto no-print">
                        <div className="p-6 text-center border-b border-teal-700">
                            <h2 className="text-xl font-bold">Panel Guru</h2>
                            <p className="text-teal-200 text-xs mt-1">{user.name}</p>
                        </div>
                        <nav className="flex-grow p-4 space-y-2">
                            <button onClick={() => setActiveTab('pts')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'pts' ? 'bg-teal-600 shadow' : 'hover:bg-teal-700'}`}>
                                <i className="fas fa-file-alt w-6"></i> Penilaian Tengah Semester
                            </button>
                            <button onClick={() => setActiveTab('pas')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'pas' ? 'bg-teal-600 shadow' : 'hover:bg-teal-700'}`}>
                                <i className="fas fa-graduation-cap w-6"></i> Penilaian Akhir Semester
                            </button>
                            <button onClick={() => setActiveTab('results')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'results' ? 'bg-teal-600 shadow' : 'hover:bg-teal-700'}`}>
                                <i className="fas fa-chart-bar w-6"></i> Hasil Ujian Siswa
                            </button>
                        </nav>
                        <div className="p-4 border-t border-teal-700">
                            <button onClick={handleLogout} className="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded flex items-center justify-center gap-2 transition">
                                <i className="fas fa-sign-out-alt"></i> Keluar
                            </button>
                        </div>
                    </div>

                    <div className="flex-grow p-8 ml-64 overflow-y-auto min-h-screen">
                        {(activeTab === 'pts' || activeTab === 'pas') && (
                            <div className="space-y-8 fade-in no-print">
                                <h2 className="text-2xl font-bold text-gray-800 border-b pb-2 uppercase">Kelola {activeTab}</h2>
                                
                                <div className="bg-white p-6 rounded-lg shadow-sm border space-y-4">
                                    <h3 className="font-bold text-teal-700">Buat Jadwal Baru</h3>
                                    <div className="grid md:grid-cols-4 gap-4">
                                        <input className="border p-2 rounded" placeholder="Nama Pelajaran" value={newExam.subject} onChange={e => setNewExam({...newExam, subject: e.target.value})} />
                                        <input type="date" className="border p-2 rounded" value={newExam.date} onChange={e => setNewExam({...newExam, date: e.target.value})} />
                                        <input type="time" className="border p-2 rounded" value={newExam.start} onChange={e => setNewExam({...newExam, start: e.target.value})} />
                                        <input type="time" className="border p-2 rounded" value={newExam.end} onChange={e => setNewExam({...newExam, end: e.target.value})} />
                                    </div>
                                    <button onClick={createExam} className="bg-teal-600 text-white px-4 py-2 rounded font-bold hover:bg-teal-700">Buat Jadwal</button>
                                </div>

                                <div className="space-y-4">
                                    {myExams.map(exam => (
                                        <div key={exam.id} className={`bg-white border rounded-xl overflow-hidden shadow-sm ${editingExamId === exam.id ? 'ring-2 ring-teal-500' : ''}`}>
                                            <div className="p-4 bg-gray-50 flex justify-between items-center">
                                                <div>
                                                    <h3 className="font-bold text-lg">{exam.subject}</h3>
                                                    <p className="text-xs text-gray-500">{exam.date} | {exam.start} - {exam.end}</p>
                                                    <span className="text-xs font-bold text-blue-600">{exam.questions.length} Soal</span>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => setEditingExamId(editingExamId === exam.id ? null : exam.id)} className="px-3 py-1 bg-white border text-teal-600 rounded hover:bg-teal-50">
                                                        {editingExamId === exam.id ? 'Tutup' : 'Isi Soal'}
                                                    </button>
                                                    <button onClick={() => deleteExam(exam.id)} className="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200"><i className="fas fa-trash"></i></button>
                                                </div>
                                            </div>

                                            {editingExamId === exam.id && (
                                                <div className="p-6 border-t bg-white">
                                                    <div className="bg-teal-50 p-4 rounded-lg mb-6 border border-teal-100">
                                                        <div className="flex gap-4 mb-3">
                                                            <select className="border p-2 rounded" value={newQuestion.type} onChange={e => setNewQuestion({...newQuestion, type: e.target.value})}>
                                                                <option value="multiple_choice">Pilihan Ganda</option>
                                                                <option value="essay">Essay</option>
                                                            </select>
                                                            <input type="number" className="border p-2 rounded w-24" placeholder="Poin" value={newQuestion.points} onChange={e => setNewQuestion({...newQuestion, points: e.target.value})} />
                                                        </div>
                                                        <textarea className="w-full border p-2 rounded mb-3" rows="2" placeholder="Pertanyaan..." value={newQuestion.question} onChange={e => setNewQuestion({...newQuestion, question: e.target.value})}></textarea>
                                                        {newQuestion.type === 'multiple_choice' && (
                                                            <div className="grid grid-cols-2 gap-3 mb-3">
                                                                {newQuestion.options.map((opt, i) => (
                                                                    <input key={i} className="border p-2 rounded text-sm" placeholder={`Opsi ${i+1}`} value={opt} onChange={e => {
                                                                        const newOpts = [...newQuestion.options];
                                                                        newOpts[i] = e.target.value;
                                                                        setNewQuestion({...newQuestion, options: newOpts});
                                                                    }} />
                                                                ))}
                                                                <select className="col-span-2 border p-2 rounded text-sm" value={newQuestion.correctAnswer} onChange={e => setNewQuestion({...newQuestion, correctAnswer: e.target.value})}>
                                                                    <option value="">Kunci Jawaban</option>
                                                                    {newQuestion.options.map((o, i) => o && <option key={i} value={o}>{o}</option>)}
                                                                </select>
                                                            </div>
                                                        )}
                                                        <button onClick={addQuestionToExam} className="bg-teal-600 text-white px-4 py-2 rounded text-sm w-full hover:bg-teal-700">Simpan Soal</button>
                                                    </div>
                                                    <div className="space-y-2">
                                                        {exam.questions.map((q, idx) => (
                                                            <div key={q.id} className="border p-2 rounded flex justify-between">
                                                                <div>
                                                                    <span className="font-bold mr-2">#{idx+1}</span>
                                                                    <span>{q.question}</span>
                                                                </div>
                                                                <button onClick={() => deleteQuestion(exam.id, q.id)} className="text-red-500 text-xs">Hapus</button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'results' && (
                            <ResultsView results={results} teacherFilter={user.name} />
                        )}
                    </div>
                </div>
            );
        };

        // --- COMPONENT: RESULTS VIEW (Shared for Admin & Teacher) ---
        const ResultsView = ({ results, teacherFilter = null }) => {
            const [filterCategory, setFilterCategory] = useState('all');

            // Filter logic
            const filteredResults = results.filter(r => {
                const matchTeacher = teacherFilter ? r.teacher === teacherFilter : true;
                const matchCat = filterCategory === 'all' ? true : r.category === filterCategory;
                return matchTeacher && matchCat;
            });

            const handlePrint = () => {
                window.print();
            };

            return (
                <div className="space-in fade-in">
                    <div className="flex justify-between items-center mb-6 no-print">
                        <h2 className="text-2xl font-bold text-gray-800">Rekapitulasi Nilai</h2>
                        <div className="flex gap-4">
                            <select className="border p-2 rounded bg-white" value={filterCategory} onChange={e => setFilterCategory(e.target.value)}>
                                <option value="all">Semua Kategori</option>
                                <option value="pts">PTS</option>
                                <option value="pas">PAS</option>
                            </select>
                            <button onClick={handlePrint} className="bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 flex items-center gap-2">
                                <i className="fas fa-print"></i> Cetak / PDF
                            </button>
                        </div>
                    </div>

                    {/* Header Print Only */}
                    <div className="print-only text-center mb-8">
                        <h1 className="text-2xl font-bold">LAPORAN HASIL UJIAN</h1>
                        <h2 className="text-xl">SMP NEGERI 1 ARAHAN</h2>
                        <p className="text-sm mt-2">Kategori: {filterCategory === 'all' ? 'Semua Ujian' : filterCategory.toUpperCase()}</p>
                        <hr className="my-4 border-black" />
                    </div>

                    <div className="bg-white rounded-lg shadow border overflow-hidden print-container">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-indigo-50 text-indigo-900 uppercase">
                                <tr>
                                    <th className="p-3 border">Nama Siswa</th>
                                    <th className="p-3 border">NIS</th>
                                    <th className="p-3 border">Mapel</th>
                                    {!teacherFilter && <th className="p-3 border">Guru</th>}
                                    <th className="p-3 border">Kategori</th>
                                    <th className="p-3 border">Nilai (PG)</th>
                                    <th className="p-3 border">Waktu</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y">
                                {filteredResults.length === 0 ? (
                                    <tr><td colSpan="7" className="p-4 text-center text-gray-500">Belum ada data nilai.</td></tr>
                                ) : filteredResults.map((res, i) => (
                                    <tr key={i} className="hover:bg-gray-50">
                                        <td className="p-3 border font-medium">{res.studentName}</td>
                                        <td className="p-3 border">{res.nim}</td>
                                        <td className="p-3 border font-bold">{res.subject}</td>
                                        {!teacherFilter && <td className="p-3 border">{res.teacher}</td>}
                                        <td className="p-3 border"><span className="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs font-bold uppercase no-print">{res.category}</span><span className="print-only">{res.category}</span></td>
                                        <td className="p-3 border font-bold text-green-600">{res.score}</td>
                                        <td className="p-3 border text-gray-500 text-xs">{res.timestamp}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // --- ADMIN DASHBOARD ---
        const AdminDashboard = ({ 
            students, setStudents, 
            teachers, setTeachers,
            subjects, setSubjects,
            exams, setExams,
            results, 
            handleLogout 
        }) => {
            const [activeTab, setActiveTab] = useState('students');
            
            // State Siswa & Guru
            const [newStudent, setNewStudent] = useState({ name: '', nim: '', username: '', password: '' });
            const [newTeacher, setNewTeacher] = useState({ name: '', username: '', password: '' });
            
            // State Import
            const [importText, setImportText] = useState('');
            const [showImport, setShowImport] = useState(false);

            // State Pelajaran
            const [newSubject, setNewSubject] = useState({ name: '', teacher: '' });

            // LOGIKA GURU
            const addTeacher = () => {
                if(!newTeacher.name || !newTeacher.username || !newTeacher.password) return alert("Lengkapi data guru");
                setTeachers([...teachers, { ...newTeacher, id: Date.now() }]);
                setNewTeacher({ name: '', username: '', password: '' });
            };
            const deleteTeacher = (id) => setTeachers(teachers.filter(t => t.id !== id));

            // LOGIKA SISWA
            const addStudent = () => {
                if (!newStudent.name || !newStudent.nim || !newStudent.username) return alert('Data tidak lengkap!');
                const password = newStudent.password || newStudent.nim; 
                setStudents([...students, { ...newStudent, password, id: Date.now() }]);
                setNewStudent({ name: '', nim: '', username: '', password: '' });
            };
            const deleteStudent = (id) => setStudents(students.filter(s => s.id !== id));

            // LOGIKA PELAJARAN
            const addSubject = () => {
                if(!newSubject.name || !newSubject.teacher) return alert("Isi Nama Pelajaran dan Guru");
                setSubjects([...subjects, { ...newSubject, id: Date.now() }]);
                setNewSubject({ name: '', teacher: '' });
            };
            const deleteSubject = (id) => setSubjects(subjects.filter(s => s.id !== id));

            return (
                <div className="min-h-screen flex bg-gray-50">
                    <div className="w-64 bg-slate-900 text-white flex flex-col shadow-xl fixed h-full overflow-y-auto no-print">
                        <div className="p-6 text-center border-b border-slate-700">
                            <h2 className="text-xl font-bold">Admin Panel</h2>
                            <p className="text-slate-400 text-xs mt-1">SMP Negeri 1 Arahan</p>
                        </div>
                        <nav className="flex-grow p-4 space-y-2">
                            <button onClick={() => setActiveTab('students')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'students' ? 'bg-blue-600 shadow' : 'hover:bg-slate-800'}`}>
                                <i className="fas fa-users w-6"></i> Data Siswa
                            </button>
                            <button onClick={() => setActiveTab('teachers')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'teachers' ? 'bg-blue-600 shadow' : 'hover:bg-slate-800'}`}>
                                <i className="fas fa-chalkboard-teacher w-6"></i> Data Guru
                            </button>
                            <button onClick={() => setActiveTab('subjects')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'subjects' ? 'bg-blue-600 shadow' : 'hover:bg-slate-800'}`}>
                                <i className="fas fa-book w-6"></i> Data Pelajaran
                            </button>
                            <button onClick={() => setActiveTab('results')} className={`w-full text-left p-3 rounded flex items-center gap-3 transition ${activeTab === 'results' ? 'bg-blue-600 shadow' : 'hover:bg-slate-800'}`}>
                                <i className="fas fa-chart-bar w-6"></i> Hasil Ujian
                            </button>
                        </nav>
                        <div className="p-4 border-t border-slate-700">
                            <button onClick={handleLogout} className="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded flex items-center justify-center gap-2 transition">
                                <i className="fas fa-sign-out-alt"></i> Keluar
                            </button>
                        </div>
                    </div>

                    <div className="flex-grow p-8 ml-64 overflow-y-auto min-h-screen">
                        
                        {/* TAB DATA SISWA */}
                        {activeTab === 'students' && (
                            <div className="space-y-6 fade-in no-print">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Manajemen Data Siswa</h2>
                                <div className="bg-white p-6 rounded-lg shadow-sm border grid md:grid-cols-2 gap-6">
                                    <div className="space-y-3">
                                        <h3 className="font-bold text-blue-600">Tambah Manual</h3>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input className="border p-2 rounded text-sm" placeholder="Nama" value={newStudent.name} onChange={e => setNewStudent({...newStudent, name: e.target.value})} />
                                            <input className="border p-2 rounded text-sm" placeholder="NIS" value={newStudent.nim} onChange={e => setNewStudent({...newStudent, nim: e.target.value})} />
                                            <input className="border p-2 rounded text-sm" placeholder="Username" value={newStudent.username} onChange={e => setNewStudent({...newStudent, username: e.target.value})} />
                                            <input className="border p-2 rounded text-sm" placeholder="Password" value={newStudent.password} onChange={e => setNewStudent({...newStudent, password: e.target.value})} />
                                        </div>
                                        <button onClick={addStudent} className="bg-blue-600 text-white px-4 py-2 rounded text-sm w-full">Simpan Siswa</button>
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg shadow-sm border overflow-hidden">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-100 text-slate-700 uppercase font-bold">
                                            <tr>
                                                <th className="p-3">Nama</th>
                                                <th className="p-3">NIS</th>
                                                <th className="p-3">Username</th>
                                                <th className="p-3">Password</th>
                                                <th className="p-3">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {students.map(s => (
                                                <tr key={s.id} className="border-t">
                                                    <td className="p-3">{s.name}</td>
                                                    <td className="p-3">{s.nim}</td>
                                                    <td className="p-3">{s.username}</td>
                                                    <td className="p-3">{s.password}</td>
                                                    <td className="p-3"><button onClick={() => deleteStudent(s.id)} className="text-red-500"><i className="fas fa-trash"></i></button></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* TAB DATA GURU */}
                        {activeTab === 'teachers' && (
                            <div className="space-y-6 fade-in no-print">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Manajemen Data Guru</h2>
                                <div className="bg-white p-6 rounded-lg shadow-sm border flex gap-4 items-end">
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-gray-500">Nama Guru</label>
                                        <input className="w-full border p-2 rounded" value={newTeacher.name} onChange={e => setNewTeacher({...newTeacher, name: e.target.value})} />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-gray-500">Username</label>
                                        <input className="w-full border p-2 rounded" value={newTeacher.username} onChange={e => setNewTeacher({...newTeacher, username: e.target.value})} />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-gray-500">Password</label>
                                        <input className="w-full border p-2 rounded" value={newTeacher.password} onChange={e => setNewTeacher({...newTeacher, password: e.target.value})} />
                                    </div>
                                    <button onClick={addTeacher} className="bg-blue-600 text-white px-6 py-2 rounded h-10">Tambah</button>
                                </div>
                                <div className="bg-white rounded-lg shadow-sm border overflow-hidden">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-100 text-slate-700 uppercase">
                                            <tr>
                                                <th className="p-3">Nama</th>
                                                <th className="p-3">Username</th>
                                                <th className="p-3">Password</th>
                                                <th className="p-3">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {teachers.map(t => (
                                                <tr key={t.id} className="border-t">
                                                    <td className="p-3 font-bold text-blue-900">{t.name}</td>
                                                    <td className="p-3">{t.username}</td>
                                                    <td className="p-3">{t.password}</td>
                                                    <td className="p-3"><button onClick={() => deleteTeacher(t.id)} className="text-red-500"><i className="fas fa-trash"></i></button></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* TAB DATA PELAJARAN */}
                        {activeTab === 'subjects' && (
                            <div className="space-y-6 fade-in no-print">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Data Mata Pelajaran</h2>
                                <div className="bg-white p-6 rounded-lg shadow-sm border flex gap-4 items-end">
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-gray-500">Mata Pelajaran</label>
                                        <input className="w-full border p-2 rounded" value={newSubject.name} onChange={e => setNewSubject({...newSubject, name: e.target.value})} />
                                    </div>
                                    <div className="flex-1">
                                        <label className="text-xs font-bold text-gray-500">Guru Pengampu</label>
                                        <select className="w-full border p-2 rounded" value={newSubject.teacher} onChange={e => setNewSubject({...newSubject, teacher: e.target.value})}>
                                            <option value="">Pilih Guru</option>
                                            {teachers.map(t => <option key={t.id} value={t.name}>{t.name}</option>)}
                                        </select>
                                    </div>
                                    <button onClick={addSubject} className="bg-blue-600 text-white px-6 py-2 rounded h-10">Tambah</button>
                                </div>
                                <div className="bg-white rounded-lg shadow-sm border overflow-hidden">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-slate-100 text-slate-700 uppercase">
                                            <tr>
                                                <th className="p-3">Mata Pelajaran</th>
                                                <th className="p-3">Guru</th>
                                                <th className="p-3">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {subjects.map(s => (
                                                <tr key={s.id} className="border-t">
                                                    <td className="p-3">{s.name}</td>
                                                    <td className="p-3">{s.teacher}</td>
                                                    <td className="p-3"><button onClick={() => deleteSubject(s.id)} className="text-red-500"><i className="fas fa-trash"></i></button></td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'results' && <ResultsView results={results} />}
                    </div>
                </div>
            );
        };

        const StudentDashboard = ({ 
            user, setUser, 
            students, setStudents,
            exams, 
            results, setResults, 
            handleLogout 
        }) => {
            const [activeScreen, setActiveScreen] = useState('menu'); 
            const [selectedCategory, setSelectedCategory] = useState(null); 
            const [newPass, setNewPass] = useState('');
            const [selectedExamId, setSelectedExamId] = useState(null);
            const [answers, setAnswers] = useState({});

            const isExamDone = (examId) => results.some(r => r.nim === user.nim && r.examId === examId);

            const handleCategorySelect = (category) => {
                setSelectedCategory(category);
                setActiveScreen('category_list');
            };

            const startExam = (exam) => {
                if(exam.questions.length === 0) return alert("Soal belum tersedia.");
                setSelectedExamId(exam.id);
                setAnswers({});
                setActiveScreen('exam');
            };

            const submitExam = () => {
                if(!confirm('Yakin kumpulkan jawaban?')) return;
                
                const currentExam = exams.find(e => e.id === selectedExamId);
                let score = 0;
                let essayAnswers = {};

                currentExam.questions.forEach(q => {
                    if (q.type === 'multiple_choice') {
                        if (answers[q.id] === q.correctAnswer) score += parseInt(q.points);
                    } else {
                        essayAnswers[q.question] = answers[q.id] || '(Kosong)';
                    }
                });

                const resultData = {
                    examId: currentExam.id,
                    studentName: user.name,
                    nim: user.nim,
                    subject: currentExam.subject,
                    teacher: currentExam.teacher, // Save teacher name
                    category: currentExam.category,
                    score: score,
                    essayAnswers: essayAnswers,
                    timestamp: new Date().toLocaleString()
                };

                setResults([...results, resultData]);
                alert(`Ujian Selesai! Nilai Pilihan Ganda: ${score}`);
                setActiveScreen('category_list');
                setSelectedExamId(null);
            };

            const changePassword = () => {
                if (!newPass) return alert('Password kosong');
                const updatedStudents = students.map(s => s.id === user.id ? { ...s, password: newPass } : s);
                setStudents(updatedStudents);
                setUser({ ...user, password: newPass });
                alert('Password berhasil diubah!');
                setNewPass('');
            };

            const activeExamData = exams.find(e => e.id === selectedExamId);
            const filteredExams = exams.filter(e => e.category === selectedCategory);

            if (activeScreen === 'menu') return (
                <div className="min-h-screen bg-gray-100 p-4">
                    <div className="max-w-5xl mx-auto space-y-6 fade-in">
                        <header className="bg-white p-6 rounded-xl shadow-sm flex justify-between items-center border-l-4 border-blue-600">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-800">Halo, {user.name}</h1>
                                <p className="text-gray-500">{user.nim} | SMP Negeri 1 Arahan</p>
                            </div>
                            <button onClick={handleLogout} className="text-red-600 hover:bg-red-50 px-4 py-2 rounded">
                                <i className="fas fa-sign-out-alt"></i> Keluar
                            </button>
                        </header>

                        <div className="grid md:grid-cols-3 gap-6">
                            <div className="md:col-span-2 space-y-4">
                                <h3 className="font-bold text-xl text-gray-800 flex items-center gap-2"><i className="fas fa-laptop-code"></i> Menu Ujian</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div onClick={() => handleCategorySelect('pts')} className="bg-white p-6 rounded-xl shadow-md cursor-pointer hover:shadow-lg border-2 border-transparent transition group">
                                        <div className="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4"><i className="fas fa-file-alt text-orange-600 text-xl"></i></div>
                                        <h3 className="text-xl font-bold text-gray-800">PTS</h3>
                                        <p className="text-gray-500 text-sm">Penilaian Tengah Semester</p>
                                    </div>
                                    <div onClick={() => handleCategorySelect('pas')} className="bg-white p-6 rounded-xl shadow-md cursor-pointer hover:shadow-lg border-2 border-transparent transition group">
                                        <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-4"><i className="fas fa-graduation-cap text-purple-600 text-xl"></i></div>
                                        <h3 className="text-xl font-bold text-gray-800">PAS</h3>
                                        <p className="text-gray-500 text-sm">Penilaian Akhir Semester</p>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-6">
                                <div className="bg-white p-6 rounded-xl shadow-sm">
                                    <h3 className="font-bold text-gray-800 border-b pb-2 mb-3">Ganti Password</h3>
                                    <input type="text" className="border p-2 rounded w-full mb-2" value={newPass} onChange={e => setNewPass(e.target.value)} placeholder="Password Baru" />
                                    <button onClick={changePassword} className="bg-slate-700 text-white px-4 py-2 rounded w-full">Simpan Password</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (activeScreen === 'category_list') return (
                <div className="min-h-screen bg-gray-100 p-4">
                    <div className="max-w-4xl mx-auto space-y-6 fade-in">
                        <header className="flex items-center gap-4 mb-6">
                            <button onClick={() => setActiveScreen('menu')} className="bg-white p-2 rounded-full shadow w-10 h-10 flex items-center justify-center"><i className="fas fa-arrow-left"></i></button>
                            <div><h1 className="text-2xl font-bold">Daftar Ujian {selectedCategory.toUpperCase()}</h1></div>
                        </header>
                        <div className="space-y-4">
                            {filteredExams.length === 0 ? <p className="text-center text-gray-500">Belum ada jadwal.</p> : filteredExams.map(exam => (
                                <div key={exam.id} className="bg-white p-5 rounded-xl shadow-sm border hover:shadow-md transition">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h4 className="font-bold text-lg text-blue-900">{exam.subject}</h4>
                                            <p className="text-sm text-gray-600">{exam.teacher}</p>
                                            <div className="text-xs text-gray-500 mt-2">{exam.date} | {exam.start} - {exam.end}</div>
                                        </div>
                                        <div>
                                            {isExamDone(exam.id) ? <span className="text-green-600 font-bold bg-green-50 px-3 py-1 rounded">Selesai</span> : 
                                            <button onClick={() => startExam(exam)} className="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow hover:bg-blue-700">Mulai</button>}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (activeScreen === 'exam' && activeExamData) return (
                <div className="max-w-3xl mx-auto p-4 min-h-screen pb-20 fade-in">
                    <div className="sticky top-4 z-10 bg-white p-4 rounded-xl shadow-lg border-b-4 border-yellow-500 mb-8 flex justify-between items-center">
                        <div><h2 className="font-bold text-lg">{activeExamData.subject}</h2></div>
                        <div className="text-red-600 font-bold animate-pulse">Sedang Mengerjakan</div>
                    </div>
                    <div className="space-y-6">
                        {activeExamData.questions.map((q, idx) => (
                            <div key={q.id} className="bg-white p-6 rounded-xl shadow-sm border">
                                <p className="text-lg font-medium mb-4">{idx + 1}. {q.question}</p>
                                {q.type === 'multiple_choice' ? (
                                    <div className="space-y-2">{q.options.map((opt, i) => (
                                        <label key={i} className={`block border p-3 rounded cursor-pointer ${answers[q.id] === opt ? 'bg-blue-50 border-blue-500' : ''}`}>
                                            <input type="radio" name={`q-${q.id}`} className="mr-3" onChange={() => setAnswers({...answers, [q.id]: opt})} checked={answers[q.id] === opt} />{opt}
                                        </label>
                                    ))}</div>
                                ) : <textarea className="w-full border p-3 rounded" rows="4" onChange={e => setAnswers({...answers, [q.id]: e.target.value})}></textarea>}
                            </div>
                        ))}
                    </div>
                    <div className="mt-8 flex justify-end gap-4">
                        <button onClick={() => setActiveScreen('category_list')} className="text-gray-500">Batal</button>
                        <button onClick={submitExam} className="bg-green-600 text-white px-8 py-3 rounded-xl font-bold shadow">Kumpulkan</button>
                    </div>
                </div>
            );
        };

        function ExamApp() {
            // --- STATE GLOBAL & STORAGE ---
            const [view, setView] = useState('login'); 
            const [user, setUser] = useState(null); 
            
            // Inisialisasi Data
            const [students, setStudents] = useState(() => {
                const saved = localStorage.getItem('smpn1arahan_students_v3');
                return saved ? JSON.parse(saved) : DEFAULT_STUDENTS;
            });
            const [teachers, setTeachers] = useState(() => {
                const saved = localStorage.getItem('smpn1arahan_teachers_v3');
                return saved ? JSON.parse(saved) : DEFAULT_TEACHERS;
            });
            const [subjects, setSubjects] = useState(() => {
                const saved = localStorage.getItem('smpn1arahan_subjects_v3');
                return saved ? JSON.parse(saved) : DEFAULT_SUBJECTS;
            });
            const [exams, setExams] = useState(() => {
                const saved = localStorage.getItem('smpn1arahan_exams_v3');
                return saved ? JSON.parse(saved) : DEFAULT_EXAMS;
            });
            const [results, setResults] = useState(() => {
                const saved = localStorage.getItem('smpn1arahan_results_v3');
                return saved ? JSON.parse(saved) : [];
            });
            
            const [adminCreds] = useState({ username: 'admin', password: 'arkan@yumna' });
            const [loginInput, setLoginInput] = useState({ username: '', password: '' });

            // --- EFFECT: SAVE DATA ---
            useEffect(() => { localStorage.setItem('smpn1arahan_students_v3', JSON.stringify(students)); }, [students]);
            useEffect(() => { localStorage.setItem('smpn1arahan_teachers_v3', JSON.stringify(teachers)); }, [teachers]);
            useEffect(() => { localStorage.setItem('smpn1arahan_subjects_v3', JSON.stringify(subjects)); }, [subjects]);
            useEffect(() => { localStorage.setItem('smpn1arahan_exams_v3', JSON.stringify(exams)); }, [exams]);
            useEffect(() => { localStorage.setItem('smpn1arahan_results_v3', JSON.stringify(results)); }, [results]);

            // --- AUTH ---
            const handleLogin = (e) => {
                e.preventDefault();
                const { username, password } = loginInput;

                // 1. Admin
                if (username === adminCreds.username && password === adminCreds.password) {
                    setUser({ role: 'admin', name: 'Administrator' });
                    setView('adminDashboard');
                    return;
                }
                
                // 2. Guru
                const teacher = teachers.find(t => t.username === username && t.password === password);
                if (teacher) {
                    setUser({ role: 'teacher', ...teacher });
                    setView('teacherDashboard');
                    return;
                }

                // 3. Siswa
                const student = students.find(s => s.username === username && s.password === password);
                if (student) {
                    setUser({ role: 'student', ...student });
                    setView('studentDashboard');
                    return;
                }

                alert('Username atau Password salah!');
            };

            const handleLogout = () => {
                setUser(null);
                setLoginInput({ username: '', password: '' });
                setView('login');
            };

            return (
                <div>
                    {view === 'login' && <LoginView handleLogin={handleLogin} loginInput={loginInput} setLoginInput={setLoginInput} />}
                    {view === 'adminDashboard' && (
                        <AdminDashboard 
                            students={students} setStudents={setStudents}
                            teachers={teachers} setTeachers={setTeachers}
                            subjects={subjects} setSubjects={setSubjects}
                            exams={exams} setExams={setExams}
                            results={results}
                            handleLogout={handleLogout}
                        />
                    )}
                    {view === 'teacherDashboard' && (
                        <TeacherDashboard 
                            user={user}
                            exams={exams} setExams={setExams}
                            results={results}
                            handleLogout={handleLogout}
                        />
                    )}
                    {view === 'studentDashboard' && (
                        <StudentDashboard 
                            user={user} setUser={setUser}
                            students={students} setStudents={setStudents}
                            exams={exams}
                            results={results} setResults={setResults}
                            handleLogout={handleLogout}
                        />
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExamApp />);
    </script>
</body>
</html>